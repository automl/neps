name: Generate and Deploy Colab Notebooks

on:
  workflow_dispatch:  # Manual trigger
  push:
    branches:
      - main
    paths:
      - 'neps_examples/tutorials/*.py'

jobs:
  generate-notebooks:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: Checkout main branch
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install jupytext nbformat

      - name: Generate notebooks from Python files
        run: |
          # Switch back to main to read the Python files
          git checkout main -- neps_examples/tutorials/

          # Create output directory
          mkdir -p notebooks/neps_examples/tutorials

          # Convert each Python file to notebook
          for py_file in neps_examples/tutorials/*.py; do
            if [ -f "$py_file" ]; then
              basename=$(basename "$py_file" .py)
              notebook_file="notebooks/neps_examples/tutorials/${basename}.ipynb"
              
              echo "Converting $py_file to $notebook_file"
              jupytext --to notebook "$py_file" --output "$notebook_file"
              
              # Add Colab badge cell at the top
              python3 << 'EOF'
